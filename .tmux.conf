## Prefix Keys
unbind C-b
#set-option -g prefix C-\\  # Tentative Change: Remember to change in Wezterm too
#bind-key C-\\ send-prefix   # Forward Prefix
set-option -g prefix C-Space  # Tentative Change: Remember to change in Wezterm too
bind-key C-Space send-prefix   # Forward Prefix

# Disable/Enable Prefix
# F2 to go deeper i.e. disable, F1 to come back up i.e. enable
# HACK: This doesn't go in the "stack order" that one might expect,
#      but I couldn't think of a better way that doesn't have caveats
#      (e.g. using a simple depth counter is meaningless when other
#      clients connect to the same session).
#      This should suffice if the nesting isn't too deep or if we do
#      not need to go back-and-fourth often.
# Tip: The bottom most status bar represents who has control of
#      the prefix key currently
unbind -    # Default used to clear the most recent buffer (tmux clipboard)
bind-key -n F1 if-shell '[ "$(tmux show-options -v -t "#{session_name}" prefix)" = "None" ]' {
    # show-options by default show session options, the expansion #{session_name} is
    # detailed in `man 1 tmux` under "FORMATS"
    set-option prefix C-Space
    set-option status on
} {
    send-keys F1    # Propagate "Enable" to the inner tmux
}
bind-key -n F2 if-shell '[ "$(tmux show-options -v -t "#{session_name}" prefix)" = "None" ]' {
    send-keys F2    # Propagate "Disable" to the inner tmux
} {
    set-option prefix None
    set-option status off
}
# Pass-through (the keys that were used)
bind-key F1 send-keys F1    # e.g. so that Leader + F1 sends F1 through
bind-key F2 send-keys F2

## General Options
set -g history-limit 3500
set -g mouse on
set -g base-index 1         # Sets window indexing from
setw -g pane-base-index 1   # Sets pane indexing from 1
set -g renumber-windows on  # Renumber windows when one is removed
set -g escape-time 50      # Mainly to remove the delay when pressing Esc to get into copy-mode
                            # (might have side effects on other function keys)
set -g mode-keys vi
set -g automatic-rename off     # Do not allow renaming of windows (including via escape seq. by other programs)
set -g allow-rename off     # Do not allow renaming of windows (including via escape seq. by other programs)

## Styling
set -g pane-border-style fg=color8
set -g pane-active-border-style fg=blue

# Pop-Up Menu Styling (e.g. when right clicking)
# NOTE: Some options are commented out temporarily for
#       compatibility with Debian until Debian catches up
set -g menu-selected-style bg=magenta,fg=black
#set -g menu-style fg=blue
#set -g menu-border-style fg=blue
#set -g menu-border-lines rounded     # e.g. single, double, heavy, simple

# Copy Mode Styling
set -g copy-mode-match-style bg=color8,fg=yellow    # Search Matches
set -g copy-mode-current-match-style bg=yellow,fg=black    # Search Matches
#set -g copy-mode-mark-style bg=color8,fg=green     # Doesn't seem to work, used mode-style instead
set -g mode-style bg=color8,fg=green    # Affects Window Selection Menu, and somehow the Copy Mode Selection

# Status Bar
set -g status-position bottom
set -g status-style "fg=black"  # To remove background

set -g message-style bg=black,fg=blue   # e.g. When typing commands
set -g message-command-style bg=black,fg=red   # e.g. `Esc` when typing commands

set -g status-left ""
#set -g status-left "#[bg=green] #S #[fg=black,bg=default] "  # Session name
#set -g status-left-length 10 # Max Length

set -g status-right "#[fg=blue] %a %Y-%m-%d #[bg=blue,fg=color234] %H:%M "
set -g status-right-length 50

# Window (the windows shown in the status bar)
set -g window-status-format " #[fg=blue]#I#[fg=default] #W "   # e.g. #F - Indicator (*,-)
set -g window-status-style bg=default,fg=white
set -g window-status-current-format " #I #W "
#set -g window-status-current-format "#[bg=blue,fg=color234] #I #[bg=default,fg=white] #W "    # Alt Style: Highlights just the number
set -g window-status-current-style bg=blue,fg=color234
set -g window-status-separator ""

# Activity monitoring per-window with `setw monitor-activity on`
# Silence monitoring per-window with `setw monitor-silence 60` for 60s
set -g window-status-activity-style fg=red,blink     # Applies also for silence monitoring
# Bell monitoring per-window with `setw monitor-bell on`
set -g window-status-bell-style fg=red,blink
# NOTE: This doesn't override styles defined in `window-status-format` apart from `default` values


## Clipboard
setw -g mode-keys vi
bind-key Escape copy-mode
bind -T copy-mode-vi v send -X begin-selection  # Begin selection with v (default space)
bind -T copy-mode-vi y send-keys -X copy-pipe   # y to copy
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel    # Enter (default tmux copy) to copy and exit


## Markers
# We can mark windows in the window chooser (Prefix+w) with `m` or unmark with `M`
bind \` switch-client -t'{marked}'


## Panes
unbind \"
bind s split-window -v -c "#{pane_current_path}"
bind S split-window -fv -c "#{pane_current_path}"
unbind %
bind v split-window -h -c "#{pane_current_path}"
bind V split-window -fh -c "#{pane_current_path}"
# ! - Defaults to transferring to new window

# Pane Movement
bind C-q command-prompt -p "swap-with" "swap-pane -t '%%'"
# { - Defaults swap-pane -U
# { - Defaults swap-pane -D

# Pane Navigation
bind h select-pane -L
bind l select-pane -R
bind j select-pane -D
bind k select-pane -U
# q - Defaults to quick select by number
# x - Defaults to closing the pane

# Pane Resize
bind -r C-Left resize-pane -L 1
bind -r C-Right resize-pane -R 1
bind -r C-Up resize-pane -U 1
bind -r C-Down resize-pane -D 1
# z - Defaults to fully zoomed

## Windows
bind c new-window -c "#{pane_current_path}"
# & - Defaults to kill window
# , - Defaults to rename

# Windows Navigation
bind Bspace last-window
# n - Defaults to next window
# p - Defaults to previous window
# w - Default to selection tree
# numbers - Default to switching via index
