# Config for application windowing / behaviour

set {
	$sticky floating enable; sticky enable; shadows enable
	$float floating enable; shadows enable

	$ii inhibit_idle focus
	$video inhibit_idle fullscreen; border none; max_render_time off
	$game inhibit_idle focus; floating enable; border none; fullscreen enable
	$important inhibit_idle open; floating enable; border pixel 1
	$max inhibit_idle visible; floating enable; sticky enable; border pixel 1
}

# To allow for one-time "for_window" rules for specific windows, we will abuse "container
# marks", which is supposed to be a list of unique identifiers for a container, but we
# will set one long mark called the "for_this" mark, which will be in the format of a
# list of colon-delimited pre-defined "rules": "for_this:rule1:rule2:"
# The for_window rules here will parse this "for_this" mark for any rules, and apply them
# appropriately at runtime
# (This is inspired from https://github.com/swaywm/sway/issues/4045#issuecomment-482823035)
#
# I mainly use his to spawn a window in the scratchpad without any seemingly app_id / classname
# hacks.
# To spawn a window in scratchpad we simply run: swaymsg 'set $for_this scratchpad:focus; exec prgm'
# Or in the config: bindsym {keybind} set $$for_this scratchpad:focus; exec prgm
set $for_this none
# This reads from the $for_this variable and create the mark. This is done for all windows, which
# will by default have the mark "for_this:none:"
# ($$ so the replacement of the $for_this happens at runtime, see `man 5 sway` search `\$\$`)
for_window [shell="."] mark --add "for_this:$$for_this:"
# These will parse each rule listed and apply the for_window rule
for_window [con_mark=^for_this.*:scratchpad:] move to scratchpad
for_window [con_mark=^for_this.*:focus:] focus
# Here we clear the mark (we will not be able to see the mark from get_tree anymore)
# We also reset $for_this back to "none" at runtime for new windows
for_window [con_mark=^for_this:] mark --toggle "for_this:$$for_this:" ; set $$for_this none

## Custom windowing rules
for_window {
    # By X11 Window Roles
    [window_role="pop-up"] $float
    [window_role="bubble"] $float
    [window_role="task_dialog"] $float
    [window_role="Preferences"] $float
    [window_type="dialog"] $float
    [window_type="menu"] $float
    [window_role="About"] $float

    # Custom Classes
    # Some programs (e.g. WezTerm) allow us to set custom windowing
    # system class / app_id.
    [app_id="\[_float\]"] $float

    # Generic Title
    [title="File Operation Progress"] $sticky, resize set width 40 ppt height 30 ppt
    [title="Picture in picture"] $sticky
    [title="waybar_htop"] $float, resize set width 70 ppt height 70 ppt
    [title="waybar_nmtui"] $float
    [title="Save File"] $float

    [class="Yad" instance="yad"] $float
    [app_id="yad"] $float
    [app_id="blueman-manager"] $float,  resize set width 40 ppt height 30 ppt
    [app_id="pavucontrol" ] $float, resize set width 40 ppt height 30 ppt
    [app_id="floating_shell_portrait"] $sticky, resize set width 30 ppt height 40 ppt

    [app_id="firefox" title="Firefox — Sharing Indicator"] kill

    # Kitty
    # Seem to have some dimensional problems with floating
    [app_id="kitty" floating] resize set width 45 ppt height 50 ppt

    # Thunar
    [app_id="[Tt]hunar" title="Confirm to replace files"] $float
    [app_id="[Tt]hunar" title="^Rename .*"] $float

    # Okular
    [app_id="org.kde.okular" title="^New Text Note — Okular$"] $float

    # VirtualBox
    # Floats with minimum width and height if not resized, bug? (seems fixed)
    #[class="VirtualBoxVM" window_type="dialog"] $float, resize set width 15 ppt height 16 ppt

    # ThunderBird
    [app_id="org.mozilla.Thunderbird"] $float
    [app_id="org.mozilla.Thunderbird" title="^Mozilla Thunderbird$"] floating disable
    [app_id="org.mozilla.Thunderbird" title=" - Mozilla Thunderbird$"] floating disable
    #[app_id="org.mozilla.Thunderbird" title="^\d+ Reminder$"] $float, resize set width 40 ppt height 30 ppt
    #[app_id="org.mozilla.Thunderbird" title="^New Event:$"] $float

    # Telegram Desktop
    [app_id="org.telegram.desktop" title="^Media viewer$"] $float, fullscreen disable

    # Waydroid (currently very buggy when tiled)
    [app_id="^Waydroid$"] $float
    [app_id="^waydroid\."] $float

    ## Inhibit Idle
    [app_id="firefox"] inhibit_idle fullscreen
    [app_id="Chromium"] inhibit_idle fullscreen
}
